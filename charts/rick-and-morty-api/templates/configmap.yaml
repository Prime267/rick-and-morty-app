{{- if .Values.logging.enabled }}
apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "rick-and-morty-api.fullname" . }}-fluent-bit-config
  labels:
    {{- include "rick-and-morty-api.labels" . | nindent 4 }}
data:
  fluent-bit.conf: |
    [SERVICE]
        Flush          5
        Log_Level      info
        Daemon         off
        Parsers_File   parsers.conf

    [INPUT]
        Name           tail
        Path           /var/log/app/*.log
        Parser         json
        Tag            app.*

    [OUTPUT]
        Name           stdout
        Match          *
  parsers.conf: |
    [PARSER]
        Name           json
        Format         json
        Time_Key       time
        Time_Format    %Y-%m-%dT%H:%M:%S.%L
        Time_Keep      On
{{- end }}